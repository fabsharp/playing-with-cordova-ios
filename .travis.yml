language: objective-c
osx_image: xcode9.4
sudo: false

env:
  - TRAVIS_NODE_VERSION: 12

before_install:
  - nvm install $TRAVIS_NODE_VERSION

install:
  - npm install -g cordova@latest
  - npm install

before_script:
  - cordova platform add ios
script:
  - node --version
  - npm --version
  - cordova build ios
  - zip -r release.zip platforms/ios/build/emulator/
  - mkdir Payload
  - cp platforms/ios/build/emulator/HelloCordova.app Payload/
  - ls Payload/
  - zip -r HelloCordova.zip Payload
  - mv HelloCordova.zip HelloCordova.ipa
  - ls

deploy:
  - provider: releases
    file_glob: true
    file:
      - release.zip
      - HelloCordova.ipa
    name: release-ios
    api_key:
      secure: $GITHUB_TOKEN
    skip_cleanup: true
    draft: true
